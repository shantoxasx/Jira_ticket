<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edenred</title>
    <style>
        body.background {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            font-family: 'Outfit', sans-serif;
            background-color: white;
            background-repeat: no-repeat; 
            background-size: 100% 150%; 
            background-position: center;
        }
        .top-bar-wrapper {
            position: relative;
            background-color: black;
        }
        .top-bar-wrapper::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 5px;
            background-color: red;
        }
        .top-bar {
            color: white;
            padding: 5px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 4px solid red;
        }
        .top-bar a {
            color: white;
            text-decoration: none;
            margin-right: 10px;
        }
        .social-icons a {
            margin-left: 10px;
            font-size: 16px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
        }
        .fading-underline {
            height: 2px;
            background: linear-gradient(to right, transparent, red, transparent);
            margin-top: 10px;
            padding: 1px 0; 
        }
        #result {
            margin-top: 20px;
            background-color: white;
            display: flex;
            justify-content: center;
        }
        .jira-card {
            background-color: #fff;
            border-radius: 12px;
            box-shadow: 
                0 10px 90px rgba(0, 0, 0, 0.15),
                0 1px 15px rgba(0, 0, 0, 0.1),
                0 0 0 1px rgba(213, 43, 30, 0.05);
            padding: 25px;
            max-width: 1200px;
            width: 100%;
            margin: 30px auto;
            font-family: 'Outfit', sans-serif;
            border-bottom: 5px solid #d52b1e;
            border-top: 5px solid #d52b1e;
            position: relative;
            overflow: hidden;
        }
 .jira-card::before {
    content: '';
    position: absolute;
    top: 5px;
    left: 5px;
    right: 5px;
    bottom: 5px;
    background: linear-gradient(135deg, rgba(213, 43, 30, 0.05) 0%, rgba(255, 255, 255, 0) 100%);
    z-index: -1;
    border-radius: 8px;
}

.jira-card::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: 
        radial-gradient(circle at top left, rgba(213, 43, 30, 0.05) 0%, transparent 15%),
        radial-gradient(circle at bottom right, rgba(213, 43, 30, 0.05) 0%, transparent 15%);
    z-index: -1;
}
        .jira-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .jira-header-underline {
            height: 2px;
            background-color: #d52b1e;
            width: 100%;
        }
        .jira-header h3 {
            color: #d52b1e;
            margin: 0;
        }
        .status-badge {
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: bold;
        }
        .status-badge-green {
            background-color: #28a745;
            border: 2px solid #28a745;
        }
        .status-badge-blue {
            background-color: #0077be;
            border: 2px solid #0077be;
        }
.jira-content {
    display: flex;
    justify-content: space-between;
    margin-bottom: 20px;
}

.left-column, .right-column {
    width: 48%;
}

.info-item {
    padding: 10px 15px;
    margin-bottom: 10px;
    border-radius: 4px;
    transition: all 0.3s ease;
    position: relative;
    overflow: visible; /* Changed from hidden to visible */
    word-wrap: break-word; /* Allows long words to break and wrap */
    overflow-wrap: break-word; /* Alternative property for word wrapping */
}

.info-item::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2.5px;
    transition: width 0.3s ease;
	
}

.info-item strong {
    display: block;
    margin-bottom: 5px;
}

.info-item a[href^="mailto:"] {
    color: #0077be;
    text-decoration: none;
    display: inline-block;
   
}


.info-item:hover::after {
    width: 100%;
}

.red-border::after {
    background-color: #d52b1e;
}

.blue-border::after {
    background-color: #0077be;
}

.green-border::after {
    background-color: green;
}

.info-item, .info-item strong {
    color: black;
}

.info-item a[href^="mailto:"] {
    color: #0077be;
}

.red-border {
    border-left: 3px solid #d52b1e;
}

.blue-border {
    border-left: 3px solid #0077be;
}

.green-border {
    border-left: 3px solid green;
}
        .description-box {
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .description-box h4 {
            margin-top: 0;
            color: #d52b1e;
        }
        .description-box pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Outfit', sans-serif;
            font-size: inherit;
            color: #333;
            margin: 0;
        }
        .dates {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .date-item {
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-block;
        }
        .updated-date {
            border: 2px solid #d52b1e;
            color: #d52b1e;
        }
        .created-date {
            border: 2px solid #0077be;
            color: #0077be;
        }
        .comment-box {
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
        }
        .comment-box h4 {
            margin-top: 0;
            color: #d52b1e;
        }
        .comment {
            background-color: white;
            border: 1px solid #eee;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 15px;
        }
        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .comment-author {
            background-color: #fff;
            color: #d52b1e;
            border: 2px solid #d52b1e;
            border-radius: 20px;
            padding: 3px 10px;
            font-weight: bold;
        }
        .comment-date {
            background-color: #fff;
            color: #0077be;
            border: 2px solid #0077be;
            border-radius: 20px;
            padding: 3px 10px;
            font-size: 0.9em;
        }
        .comment-content {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Outfit', sans-serif;
            font-size: inherit;
            color: #333;
            margin: 0;
            padding: 10px;
            background-color: #f8f8f8;
            border-radius: 4px;
        }
        .error-card {
            background-color: #fff0f0;
            border: 1px solid #ffcccb;
        }
        .error-message {
            color: #d52b1e;
            font-weight: bold;
        }
        .show-comments-btn {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            font-size: 16px;
            font-weight: bold;
            color: white;
            background-color: #333;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .show-comments-btn:hover {
            background-color: #555;
        }
        .extra-info-container {
            text-align: center;
            margin-bottom: 20px;
        }
        .show-extra-info-btn {
            display: inline-block;
            padding: 10px 20px;
            font-size: 16px;
            font-weight: bold;
            color: white;
            background-color: #0077be;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .show-extra-info-btn:hover {
            background-color: #005c8f;
        }
        .extra-info-box {
            overflow: hidden;
            max-height: 0;
            transition: max-height 0.3s ease-out;
        }
        .extra-info-box.show {
            max-height: 500px;
            transition: max-height 0.5s ease-in;
        }
        .extra-info-content {
            display: flex;
            justify-content: space-between;
			 text-align: left;
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-top: 10px;
        }
        .extra-info-left-column,
        .extra-info-right-column {
            width: 48%;
        }
        .extra-info-left-column .info-item,
        .extra-info-right-column .info-item {
            margin-bottom: 10px;
        }
        .green-border {
            border-left: 3px solid #28a745;
        }
     
        #loading-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        } /* HTML: <div class="loader"></div> */
.loader {
  width: 50px;
  aspect-ratio: 1;
  display: grid;
}
.loader:before,
.loader:after {
  content: "";
  grid-area: 1/1;
  border-radius: 50%;
  background: #f03355;
  -webkit-mask:repeating-linear-gradient(#000 0 5px,#0000 0 10px);
  animation: l35 1.5s infinite;
}
.loader:after {
  -webkit-mask:repeating-linear-gradient(#0000 0 5px,#000 0 10px);
  --s:-1;
}
@keyframes l35 {
  0%,
  10% {transform: translate(0) rotate(0)}
  35% {transform: translate(calc(var(--s,1)*50%)) rotate(0)}
  66% {transform: translate(calc(var(--s,1)*50%)) rotate(calc(var(--s,1)*180deg))}
  90%,
  100% {transform: translate(0) rotate(calc(var(--s,1)*180deg))}
}

.history-timeline {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: flex-start;
}

.history-box {
    background-color: #f0f0f0;
    border: 1px solid #ddd;
    border-radius: 4px;
    padding: 10px;
    width: calc(33.333% - 10px);
    box-sizing: border-box;
    margin-bottom: 10px;
}

.history-box-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 5px;
}

.history-author {
    font-weight: bold;
    color: #d52b1e;
}

.history-date {
    font-size: 0.8em;
    color: #666;
}

.history-box-content {
    font-size: 0.9em;
}

.history-item-detail {
    margin-bottom: 5px;
}

@media (max-width: 768px) {
    .history-box {
        width: calc(50% - 10px);
    }
}

@media (max-width: 480px) {
    .history-box {
        width: 100%;
    }
}
.button-container {
    display: flex;
    justify-content: center;
    gap: 20px; /* This creates space between the buttons */
    margin: 20px 0; /* This adds some vertical margin */
}

.show-comments-btn {
    flex: 1; /* This makes the buttons grow to fill the container */
    max-width: 200px; /* This limits the width of each button */
}


html, body {
    height: 100%;
    margin: 0;
    padding: 0;
}

body {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
}

#result {
    flex: 1 0 auto;
}

.edenred-footer {
    background-color: #222;
    color: #fff;
    padding: 40px 0 20px;
    font-family: 'Outfit', sans-serif;
    position: relative;
    flex-shrink: 0;
}

.edenred-footer::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 5px;
    background-color: #d52b1e;
}

.footer-content {
    display: flex;
    justify-content: space-between;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
}

.contact-info, .company-info {
    flex: 1;
}

.info-item {
    display: flex;
    align-items: flex-start;
    margin-bottom: 20px;
}

.info-item i {
    font-size: 20px;
    margin-right: 15px;
    color: #d52b1e;
}

.info-item span, .info-item a {
    font-size: 14px;
    line-height: 1.5;
}

.info-item a {
    color: #fff;
    text-decoration: none;
    transition: color 0.3s ease;
}

.info-item a:hover {
    color: #d52b1e;
}

.company-info h3 {
    font-size: 18px;
    margin-bottom: 15px;
    color: #d52b1e;
}

.company-info p {
    font-size: 14px;
    line-height: 1.6;
    margin-bottom: 20px;
}

.social-icons a {
    color: #fff;
    font-size: 20px;
    margin-right: 15px;
    transition: color 0.3s ease;
}

.social-icons a:hover {
    color: #d52b1e;
}

@media (max-width: 768px) {
    .footer-content {
        flex-direction: column;
    }

    .contact-info, .company-info {
        margin-bottom: 30px;
    }
}

 #initial-message {
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: #888;
            text-align: center;
            white-space: nowrap;
        }

        #initial-message::after {
            content: '|';
            position: absolute;
            right: -10px;
            animation: blink 0.7s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }

    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
	   <link href="style_page.css" rel="stylesheet">
</head>
<body class="background">
    <div class="top-bar-wrapper">
        <div class="top-bar">
            <div class="date-news">
                <span id="current-date"></span>
            </div>
            <div class="social-icons">
                <a class="nav-link text-body" href="#"><small class="fab fa-twitter"></small></a>
                <a class="nav-link text-body" href="#"><small class="fab fa-facebook-f"></small></a>
                <a class="nav-link text-body" href="#"><small class="fab fa-linkedin-in"></small></a>
                <a class="nav-link text-body" href="#"><small class="fab fa-instagram"></small></a>
                <a class="nav-link text-body" href="#"><small class="fab fa-google-plus-g"></small></a>
            </div>
        </div>
    </div>
    <div class="header">
        <div>
             <h2 style="color: red;">EDENRED</h2>
        </div>
        <div class="search-box">
            <input type="text" placeholder=" "/><span></span>
        </div>
        <div>
            <a href="#" style="color: #d52b1e; margin-right: 20px; text-decoration: none;">Home</a>
            <a href="#" style="color: #d52b1e; margin-right: 20px; text-decoration: none;">Login</a>
            <a href="#" style="color: #d52b1e; margin-right: 20px; text-decoration: none; border: 2px solid #d52b1e; border-radius: 25px; padding: 8px;">News Page</a>
        </div>
    </div>
    <div class="fading-underline"></div>
    <div id="initial-message"></div>
    <div id="loading-screen">
        <div class="loader"></div>
        <p>Loading...</p>
    </div>
    <div id="result"></div>

    <script>
    function updateDate() {
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        const currentDate = new Date().toLocaleDateString('en-US', options);
        document.getElementById('current-date').textContent = currentDate;
    }
    updateDate();

    function parseDescription(description) {
        if (!description || !description.content) return 'No Description';
        let text = '';
        description.content.forEach(block => {
            if (block.type === 'paragraph') {
                block.content.forEach(content => {
                    if (content.type === 'text') {
                        text += content.text;
                    } else if (content.type === 'hardBreak') {
                        text += '\n';
                    }
                });
                text += '\n';
            }
        });
        return text.trim();
    }

    async function fetchJiraIssue(issueNumber) {
        const username = 'itsdsupportteam-it@edenred.com';
        const apiToken = 'ATATT3xFfGF0oykRAlCx3OedmyqYIdNehstFll2vYUvSfnNwrg3dafqnuUvLrQ7t7WH3sR5GtE47APpp-FLe85btXnXT5ntviKU_O_qC8fG_eHRSHfJUVF-bVD3_MVtB_kyro3Lv3Q45ZFQsnXvDHO-eKnZvlmtyLyuC1yCJ_GYLm59JMQzMchk=F66895D4';
        const jiraUrl = `https://edenred.atlassian.net/rest/api/3/issue/${issueNumber}`;

        try {
            const response = await axios.get(jiraUrl, {
                auth: {
                    username: username,
                    password: apiToken
                }
            });
            return response.data;
        } catch (error) {
            console.error('Error fetching Jira issue:', error);
            throw error;
        }
    }

    async function fetchHistory(issueNumber) {
        const username = 'itsdsupportteam-it@edenred.com';
        const apiToken = 'ATATT3xFfGF0xR-htiXcBHX6aatNhkXrdWZK7KCtUfxbLJ9hdee0Q0Vj6o_i02NM4vUreHEbUp8nD1McbcR8Ntz2Vkl44Opy1oYxRTEH8v5GN6R6b7-Z-hFk5u-B-kJY7H-rbSzszHw3j-3mDXNzSnzPl5b5bCLAu1rHE4E9I7nYfzOoSWKV5NY=40905D23';
        const jiraUrl = `https://edenred.atlassian.net/rest/api/3/issue/${issueNumber}/changelog`;

        try {
            const response = await axios.get(jiraUrl, {
                auth: {
                    username: username,
                    password: apiToken
                }
            });
            return formatHistory(response.data.values);
        } catch (error) {
            console.error('Error fetching history:', error);
            return `<p class="error-message">Error fetching history: ${error.message}</p>`;
        }
    }

    async function searchJiraIssue(issueNumber) {
        document.getElementById('loading-screen').style.display = 'flex';
        document.getElementById('initial-message').style.display = 'none';

        try {
            const [data, historyContent] = await Promise.all([
                fetchJiraIssue(issueNumber),
                fetchHistory(issueNumber)
            ]);

            const description = parseDescription(data.fields?.description);
            const createdDate = formatDateItalian(data.fields?.created);
            const updatedDate = formatDateItalian(data.fields?.updated);
            const creatorName = data.fields?.creator?.displayName ?? 'Unknown';
            const creatorEmail = data.fields?.creator?.emailAddress ?? '';
            const creatorLink = creatorEmail ? `<a href="mailto:${creatorEmail}">${creatorName}</a>` : creatorName;
            const recipients = formatRecipients(data.fields?.customfield_10016);
            const commentHistory = formatComments(data.fields?.comment?.comments);
            
            const organization = data.fields?.customfield_10004?.[0]?.name ?? 'No Organization';
            const sfdcCaseNumber = data.fields?.customfield_14896 ?? 'No SFDC Case Number';
            
            const status = data.fields?.status?.name ?? 'Unknown';
            const statusClass = status === 'Chiusa' || status.startsWith('Resolved') ? 'status-badge-green' : 'status-badge-blue';

            // Process SLA information
            const slaInfo = [];

            // Time First Take in Charge L1
            if (data.fields?.customfield_16699?.completedCycles?.length > 0) {
                const l1Cycle = data.fields.customfield_16699.completedCycles[0];
                slaInfo.push({
                    name: "Time First Take in Charge L1",
                    respected: !l1Cycle.breached,
                    message: l1Cycle.breached ? "SLA for L1 has been breached" : "Support respected the SLA of L1"
                });
            }

            // Time to Assignment
            if (data.fields?.customfield_16562?.completedCycles?.length > 0) {
                const assignmentCycle = data.fields.customfield_16562.completedCycles[0];
                slaInfo.push({
                    name: "Time to Assignment",
                    respected: !assignmentCycle.breached,
                    message: assignmentCycle.breached ? "SLA for Time to Assignment has been breached" : "Support respected the SLA of Time to Assignment"
                });
            }

            // Time to Resolution Italy
            if (data.fields?.customfield_16572?.completedCycles?.length > 0) {
                const resolutionCycle = data.fields.customfield_16572.completedCycles[0];
                slaInfo.push({
                    name: "Time to Resolution Italy",
                    respected: !resolutionCycle.breached,
                    message: resolutionCycle.breached ? "SLA for Time to Resolution Italy has been breached" : "Support respected the Time to Resolution Italy"
                });
            }

            const slaInfoHtml = slaInfo.map(info => `
                <div class="info-item ${info.respected ? 'green-border' : 'red-border'}">
                    <strong>${info.name}:</strong> ${info.message}
                </div>
            `).join('');

            const result = `
                <div class="jira-card">
                    <div class="jira-header-container">
                        <div class="jira-header">
                            <h3>${data.fields?.summary ?? 'No Summary'}</h3>
                             <div class="status-badge ${statusClass}">${status}</div>
                        </div>
                        <div class="jira-header-underline"></div>
                    </div>
                    <br>
                    <br>
                    <div class="jira-content">
                        <div class="left-column">
                            <div class="info-item red-border"><strong>Request Type:</strong> ${data.fields?.customfield_10015?.requestType?.name ?? 'Not Specified'}</div>
                            <div class="info-item red-border"><strong>Priority:</strong> ${data.fields?.priority?.name ?? 'Not Set'}</div>
                            <div class="info-item red-border"><strong>Technical Component:</strong> ${data.fields?.customfield_16560?.value ?? 'N/A'}</div>
                            <div class="info-item red-border"><strong>Component:</strong> ${data.fields?.components?.[0]?.name ?? 'Nessuno Componente'}</div>
                            <div class="info-item red-border"><strong>Assignee:</strong> ${data.fields?.assignee?.displayName ?? 'Unassigned'}</div>
                        </div>
                        <div class="right-column">
                            <div class="info-item blue-border"><strong>Organization:</strong> ${organization}</div>
                            <div class="info-item blue-border"><strong>SFDC Case Number:</strong> ${sfdcCaseNumber}</div>
                            <div class="info-item blue-border"><strong>Creator:</strong> ${creatorLink}</div>
                            <div class="info-item blue-border"><strong>Recipients:</strong> ${recipients}</div>
                            <div class="info-item blue-border"><strong>AM1 Operator:</strong> ${data.fields?.customfield_16088?.displayName ?? 'Not Specified'}</div>
                        </div>
                    </div>
                     <div class="extra-info-container">
                            <button id="showExtraInfoBtn" class="show-extra-info-btn">Extra Information</button>
                            <div id="extraInfoBox" class="extra-info-box">
                                <div class="extra-info-content">
                                    <div class="extra-info-left-column">
                                        ${slaInfoHtml}
                                    </div>
                                    <div class="extra-info-right-column">
                                        <div class="info-item blue-border"><strong>AM2 Operator:</strong> ${data.fields?.customfield_16090?.displayName ?? 'Nessuno'}</div>
										<div class="info-item blue-border"><strong>AM3 Operator:</strong> ${data.fields?.customfield_16091?.displayName ?? 'Nessuno'}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <div class="dates">
                        <p class="date-item updated-date"><strong>Updated:</strong> ${updatedDate ?? 'Not Specified'}</p>
                        <p class="date-item created-date"><strong>Created:</strong> ${createdDate ?? 'Not Specified'}</p>
                    </div>
                    <div class="description-box">
                        <h4>Description:</h4>
                        <pre>${description}</pre>
                    </div>
                    <div class="button-container">
                        <button id="showCommentsBtn" class="show-comments-btn">Show Comments</button>
                        <button id="showHistoryBtn" class="show-comments-btn">Show History</button>
                    </div>
                    <div id="historyBox" class="comment-box" style="display: none;">
                        <h4>Issue History:</h4>
                        <div id="historyContent">${historyContent}</div>
                    </div>
                    <div id="commentBox" class="comment-box" style="display: none;">
                        <h4>Comment History:</h4>
                        ${commentHistory}
                    </div>
                </div>
            `;
            document.getElementById('result').innerHTML = result;
            document.getElementById('loading-screen').style.display = 'none';

            addEventListeners(issueNumber);
        } catch (error) {
            console.error('Error:', error);
            const errorMessage = `
                <div class="jira-card error-card">
                    <p class="error-message">An error occurred while fetching the data:</p>
                    <p>${error.message}</p>
                </div>
            `;
            document.getElementById('result').innerHTML = errorMessage;
            document.getElementById('loading-screen').style.display = 'none';
        }
    }

    function addEventListeners(issueNumber) {
        const extraInfoBtn = document.getElementById('showExtraInfoBtn');
        const extraInfoBox = document.getElementById('extraInfoBox');
        const commentsBtn = document.getElementById('showCommentsBtn');
        const commentBox = document.getElementById('commentBox');
        const historyBtn = document.getElementById('showHistoryBtn');
        const historyBox = document.getElementById('historyBox');

        if (extraInfoBtn && extraInfoBox) {
            extraInfoBtn.addEventListener('click', function() {
                extraInfoBox.classList.toggle('show');
                this.textContent = extraInfoBox.classList.contains('show') ? 'Hide Extra Information' : 'Extra Information';
            });
        }

        if (commentsBtn && commentBox && historyBtn && historyBox) {
            commentsBtn.addEventListener('click', function() {
                if (commentBox.style.display === 'none') {
                    commentBox.style.display = 'block';
                    historyBox.style.display = 'none';
                    this.textContent = 'Hide Comments';
                    historyBtn.textContent = 'Show History';
                } else {
                    commentBox.style.display = 'none';
                    this.textContent = 'Show Comments';
                }
            });
        }

        if (historyBtn && historyBox && commentsBtn && commentBox) {
            historyBtn.addEventListener('click', function() {
                if (historyBox.style.display === 'none') {
                    historyBox.style.display = 'block';
                    commentBox.style.display = 'none';
                    this.textContent = 'Hide History';
                    commentsBtn.textContent = 'Show Comments';
                } else {
                    historyBox.style.display = 'none';
                    this.textContent = 'Show History';
                }
            });
        }
    }

    function formatDateItalian(dateString) {
        if (!dateString) return '';
        const date = new Date(dateString);
        const options = { 
            year: 'numeric', 
            month: '2-digit', 
            day: '2-digit', 
            hour: '2-digit', 
            minute: '2-digit', 
            hour12: false 
        };
        return date.toLocaleString('it-IT', options).replace(',', '');
    }

    function formatRecipients(recipients) {
        if (!recipients || recipients.length === 0) return 'None';
        return recipients.map(recipient => {
            const name = recipient.displayName ?? 'Unknown';
            const email = recipient.emailAddress ?? '';
            return email ? `<a href="mailto:${email}">${name}</a>` : name;
        }).join(', ');
    }

    function formatComments(comments) {
        if (!comments || comments.length === 0) return '<p>No comments</p>';
        
        const formattedComments = comments
            .filter(comment => {
                if (comment.jsdPublic === false) return false;
                const commentContent = extractCommentText(comment.body);
                return commentContent && commentContent.trim() !== '';
            })
            .map(comment => {
                const authorName = comment.author?.displayName ?? 'Unknown';
                const commentDate = formatDateItalian(comment.created);
                const commentContent = extractCommentText(comment.body);
                
                return `
                    <div class="comment">
                        <div class="comment-header">
                            <span class="comment-author">${authorName}</span>
                            <span class="comment-date">${commentDate}</span>
                        </div>
                        <pre class="comment-content">${commentContent}</pre>
                    </div>
                `;
            })
            .join('');

        return formattedComments || '<p>No comments</p>';
    }

    function extractCommentText(body) {
        if (!body || !body.content) return '';

        return body.content.map(block => {
            if (block.type === 'paragraph' || block.type === 'orderedList' || block.type === 'unorderedList') {
                return extractTextFromContent(block.content);
            }
            return '';
        }).join('\n\n');
    }

    function extractTextFromContent(content) {
        if (!content) return '';
        return content.map(item => {
            if (item.type === 'text') return item.text;
            if (item.type === 'hardBreak') return '\n';
            if (item.content) return extractTextFromContent(item.content);
            return '';
        }).join('');
    }

    function formatHistory(changes) {
        if (!changes || changes.length === 0) return '<p>No history available</p>';
        
        return `
            <div class="history-timeline">
                ${changes.map(change => {
                    const author = change.author.displayName;
                    const date = formatDateItalian(change.created);
                    const items = change.items.map(item => `
                        <div class="history-item-detail">
                            <strong>${item.field}:</strong> 
                            ${item.fromString ? `From "${item.fromString}"` : ''} 
                            ${item.toString ? `To "${item.toString}"` : ''}
                        </div>
                    `).join('');
                    
                    return `
                        <div class="history-box">
                            <div class="history-box-header">
                                <span class="history-author">${author}</span>
                                <span class="history-date">${date}</span>
                            </div>
                            <div class="history-box-content">
                                ${items}
                            </div>
                        </div>
                    `;
                }).join('')}
            </div>
        `;
    }

    document.querySelector('.search-box input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            const issueNumber = this.value.trim();
            if (issueNumber) {
                document.getElementById('initial-message').style.display = 'none';
                document.getElementById('result').innerHTML = '';
                searchJiraIssue(issueNumber);
            }
        }
    });

    function typeWriter(text, i, fnCallback) {
        if (i < text.length) {
            document.getElementById("initial-message").innerHTML = text.substring(0, i+1);
            setTimeout(function() {
                typeWriter(text, i + 1, fnCallback)
            }, 100);
        } else if (typeof fnCallback == 'function') {
            setTimeout(fnCallback, 700);
        }
    }

    window.addEventListener('load', function() {
        if (!document.querySelector('.search-box input').value.trim()) {
            document.getElementById('initial-message').style.display = 'block';
            document.getElementById('loading-screen').style.display = 'none';
            typeWriter("Write Something in the Search Box", 0, function() {
                // Typing is complete
            });
        }
    });
    </script>

    <footer class="edenred-footer">
        <div class="footer-content">
            <div class="contact-info">
                <div class="info-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span style="color: white;">Via Giovanni Battista Pirelli, 18, 20124 <br>Milano, Italy</span>
                </div>
                <div class="info-item">
                    <i class="fas fa-phone"></i>
                    <span style="color: white;">02 269041</span>
                </div>
                <div class="info-item">
                    <i class="fas fa-envelope"></i>
                    <a href="mailto:support@edenred.com">support@edenred.com</a>
                </div>
            </div>
            <div class="company-info">
                <h3>About Edenred</h3>
                <p>Edenred is a leading digital platform for services and payments and the everyday companion for people at work.</p>
                <div class="social-icons">
                    <a href="#" class="fab fa-facebook-f"></a>
                    <a href="#" class="fab fa-twitter"></a>
                    <a href="#" class="fab fa-linkedin-in"></a>
                    <a href="#" class="fab fa-instagram"></a>
                </div>
            </div>
        </div>
    </footer>
</body>
</html>
